<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T9 OS ‚Äî Optimized Launcher</title>

  <!-- Google font (light) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    /* -------------------
       Variables & Reset
       ------------------- */
    :root{
      --bg-1:#06060a;
      --bg-2:#120018;
      --accent:#7b3cff;
      --muted:#9aa0a6;
      --glass: rgba(255,255,255,0.04);
      --card: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }

    /* -------------------
       Layout
       ------------------- */
    .desktop {
      height:100vh;
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      justify-content:space-between;
      position:relative;
    }

    /* wallpaper overlay (image set by JS) */
    .wallpaper {
      position: absolute;
      inset: 0;
      z-index: 0;
      background-position: center;
      background-size: cover;
      filter: contrast(1.02) saturate(1.05) brightness(0.7);
      transition: opacity 300ms ease, transform 400ms ease;
    }
    .wallpaper.dim { opacity:0.5 }

    /* main content area */
    .content {
      z-index: 2;
      padding: 28px;
      display:flex;
      flex-direction:column;
      gap:18px;
      height:calc(100vh - 72px);
    }

    /* top bar: small status */
    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      pointer-events:auto;
    }
    .top-left { display:flex; gap:12px; align-items:center; }
    .brand {
      display:flex;
      gap:10px;
      align-items:center;
      font-weight:700;
      letter-spacing:0.6px;
    }
    .brand .logo {
      width:36px;height:36px;border-radius:9px;
      background:linear-gradient(135deg,var(--accent),#2dd4bf);
      display:flex;align-items:center;justify-content:center;font-weight:800;
      color:#fff;font-size:18px;box-shadow:0 6px 22px rgba(0,0,0,0.6);
    }
    .top-right { display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px; }

    /* center area */
    .center {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .launcher {
      width:980px;
      max-width:calc(100% - 48px);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:28px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.65);
      display:flex;
      gap:18px;
      align-items:center;
      backdrop-filter:none; /* keep performance */
    }

    /* left column: welcome + wallpaper selector */
    .left-col {
      width:320px;
      min-width:220px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .welcome { font-size:22px; font-weight:700; letter-spacing: .3px; }
    .sub { color:var(--muted); font-size:13px; margin-top:2px; }

    .wall-switch {
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:8px;
    }
    .wall-thumb {
      width:72px;height:48px;border-radius:8px;cursor:pointer;
      background-size:cover;background-position:center;border:2px solid transparent;
      box-shadow:0 3px 12px rgba(0,0,0,0.5);
    }
    .wall-thumb.active { outline: 2px solid rgba(255,255,255,0.08); transform:scale(1.02) }

    /* center column: search & quick buttons */
    .mid-col {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
    }
    .search-wrap {
      width:100%;
      max-width:520px;
    }
    .search {
      display:flex;
      gap:8px;
      align-items:center;
      background:var(--glass);
      border-radius:999px;
      padding:12px 14px;
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.2);
    }
    .search input{
      background:transparent;border:0;outline:0;color:#fff;font-size:16px;width:100%;
    }
    .search .btn {
      border-radius:999px;padding:8px 12px;border:0;cursor:pointer;
      background:linear-gradient(180deg,var(--accent), #5b2fff); color:white;font-weight:600;
      box-shadow:0 6px 18px rgba(123,60,255,0.16);
    }
    .controls {
      display:flex; gap:10px; align-items:center; margin-top:8px;
    }
    .icon-btn {
      background:var(--card); border-radius:10px; padding:8px; min-width:44px; min-height:44px; display:inline-flex;
      align-items:center; justify-content:center;border:1px solid rgba(255,255,255,0.03);cursor:pointer;
    }
    .icon-btn:hover{ transform:translateY(-3px); transition:transform 140ms ease }

    /* right column: apps grid */
    .right-col {
      width:320px; min-width:220px; display:flex; flex-direction:column; gap:10px;
    }
    .apps-grid {
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:8px;
    }
    .app {
      background:var(--card);
      border-radius:12px;
      padding:8px;
      text-align:center;
      font-size:12px;
      color:#fff;
      min-height:64px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.02);
    }

    /* bottom area: iframe / content viewer */
    .viewer {
      z-index:2;
      height:290px;
      margin:0 32px 24px 32px;
      border-radius:12px;
      overflow:hidden;
      background: #000;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 18px 60px rgba(0,0,0,0.65);
    }
    .viewer iframe { width:100%; height:100%; border:0; display:block; }

    /* taskbar */
    .taskbar {
      height:56px;
      background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.4));
      display:flex;
      align-items:center;
      gap:12px;
      padding:0 18px;
      z-index:3;
      border-top: 1px solid rgba(255,255,255,0.02);
    }
    .taskbar .left, .taskbar .center, .taskbar .right { display:flex; align-items:center; gap:12px; }
    .taskbar .center { margin-left:auto; margin-right:auto; }
    .chip { font-size:13px; color:var(--muted); background:transparent; padding:6px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.03) }

    /* small utilities */
    .muted { color:var(--muted); font-size:13px }
    .small { font-size:12px; color:var(--muted) }

    /* responsive */
    @media (max-width:1000px){
      .launcher{flex-direction:column;align-items:stretch;height:auto}
      .left-col,.right-col{width:100%}
      .viewer{height:220px;margin:14px}
    }
  </style>
</head>
<body>
  <div class="desktop" role="application" aria-label="T9 OS launcher">
    <div class="wallpaper" id="wallpaper"></div>

    <div class="content">
      <div class="topbar" aria-hidden="false">
        <div class="top-left">
          <div class="brand">
            <div class="logo">T9</div>
            <div>
              <div style="font-weight:600">T9 OS</div>
              <div class="small">Play ‚Ä¢ Launch ‚Ä¢ Share</div>
            </div>
          </div>
        </div>

        <div class="top-right">
          <div id="time" class="small">--:--</div>
          <div id="battery" class="small">‚Äî%</div>
        </div>
      </div>

      <div class="center">
        <div class="launcher" role="region" aria-label="Launcher">
          <!-- LEFT -->
          <div class="left-col" aria-hidden="false">
            <div class="welcome">Welcome back</div>
            <div class="sub">Your curated games & apps ‚Äî optimized and lightweight.</div>

            <div style="margin-top:10px;">
              <div class="small">Wallpaper</div>
              <div class="wall-switch" id="wallSwitch" aria-label="Wallpaper selector">
                <!-- thumbs inserted by JS -->
              </div>
            </div>

            <div style="margin-top:10px;">
              <button class="icon-btn" id="open-settings" title="Settings">‚öôÔ∏è</button>
              <button class="icon-btn" id="toggle-logo" title="Toggle logo">üñºÔ∏è</button>
            </div>
          </div>

          <!-- MIDDLE -->
          <div class="mid-col">
            <div class="search-wrap" aria-label="Search area">
              <div class="search" role="search">
                <input id="searchInput" placeholder="Search or paste a url ‚Äî T9 OS" aria-label="Search or URL" />
                <button class="btn" id="goBtn">Open</button>
              </div>

              <div class="controls" aria-hidden="false">
                <div class="icon-btn" id="open-new-tab" title="Open new T9 tab">‚ûï</div>
                <div class="icon-btn" id="open-games" title="Open games hub">üéÆ</div>
                <div class="icon-btn" id="open-browser" title="Open browser view">üåê</div>
                <div class="chip" id="statusChip">Ready</div>
              </div>
            </div>

            <div style="width:100%; max-width:640px; display:flex; justify-content:center; gap:12px;">
              <a class="icon-btn" id="open-discord" title="Discord">üí¨</a>
              <a class="icon-btn" id="open-patreon" title="Support">‚ù§Ô∏è</a>
              <a class="icon-btn" id="open-youtube" title="YouTube">‚ñ∂Ô∏è</a>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="right-col">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <div style="font-weight:600">Apps</div>
              <div class="small">Quick launch</div>
            </div>

            <div class="apps-grid" id="appsGrid" aria-label="Apps">
              <!-- apps inserted by JS -->
            </div>
          </div>
        </div>
      </div>

      <!-- viewer iframe -->
      <div class="viewer" aria-live="polite">
        <iframe id="viewerFrame" src="about:blank" title="Content viewer"></iframe>
      </div>
    </div>

    <!-- taskbar -->
    <div class="taskbar" role="toolbar" aria-label="Taskbar">
      <div class="left">
        <div class="icon-btn" id="task-home" title="Home">üè†</div>
        <div class="icon-btn" id="task-apps" title="Apps">üìÇ</div>
      </div>

      <div class="center">
        <div class="chip" id="openTabsCount">Tabs: 0</div>
      </div>

      <div class="right">
        <div class="small" id="userInfo">T9 OS ‚Ä¢ optimized</div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * Config / Presets
     ***********************/
    const WALLPAPERS = [
      {id:'default', label:'Aurora', url:'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=1c3d471c3a1b8a7f3f3f7d3d9cb21917'},
      {id:'city', label:'City', url:'https://images.unsplash.com/photo-1512453979798-5ea266f8880c?q=80&w=1400&auto=format&fit=crop'},
      {id:'synth', label:'Synthwave', url:'https://images.unsplash.com/photo-1505483531331-3a9b2e0b3d09?q=80&w=1400&auto=format&fit=crop'},
      {id:'space', label:'Space', url:'https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?q=80&w=1400&auto=format&fit=crop'}
    ];

    const APPS = [
      {name:'Netflix', url:'https://t9os.com/active/iframe#https://netflix.com'},
      {name:'Discord', url:'https://t9os.com/active/iframe#https://discord.com'},
      {name:'Fortnite', url:'https://t9os.com/active/iframe#https://www.xbox.com/en-US/play/games/fortnite/BT5P2X999VH2'},
      {name:'TikTok', url:'https://t9os.com/active/iframe#https://www.tiktok.com'},
      {name:'YouTube', url:'https://t9os.com/active/iframe#https://www.youtube.com'},
      {name:'Windows', url:'/windows11.html'}
    ];

    /***********************
     * Helpers & DOM nodes
     ***********************/
    const wallpaperEl = document.getElementById('wallpaper');
    const wallSwitch = document.getElementById('wallSwitch');
    const appsGrid = document.getElementById('appsGrid');
    const viewerFrame = document.getElementById('viewerFrame');
    const searchInput = document.getElementById('searchInput');
    const goBtn = document.getElementById('goBtn');
    const statusChip = document.getElementById('statusChip');
    const openNewTabBtn = document.getElementById('open-new-tab');
    const openGamesBtn = document.getElementById('open-games');
    const openBrowserBtn = document.getElementById('open-browser');
    let openTabs = [];

    /***********************
     * Init wallpaper selector
     ***********************/
    function renderWallpaperThumbs(){
      wallSwitch.innerHTML = '';
      WALLPAPERS.forEach(w => {
        const el = document.createElement('div');
        el.className = 'wall-thumb';
        el.style.backgroundImage = `url("${w.url}")`;
        el.title = w.label;
        el.dataset.id = w.id;
        el.addEventListener('click', () => setWallpaper(w.id));
        wallSwitch.appendChild(el);
      });
      // mark active
      updateActiveWallThumb();
    }

    function setWallpaper(id){
      const w = WALLPAPERS.find(x=>x.id===id) || WALLPAPERS[0];
      localStorage.setItem('t9_wall', w.id);
      wallpaperEl.style.backgroundImage = `url('${w.url}')`;
      updateActiveWallThumb();
    }

    function updateActiveWallThumb(){
      const active = localStorage.getItem('t9_wall') || WALLPAPERS[0].id;
      document.querySelectorAll('.wall-thumb').forEach(t => {
        t.classList.toggle('active', t.dataset.id === active);
      });
    }

    /***********************
     * Apps grid
     ***********************/
    function renderApps(){
      appsGrid.innerHTML = '';
      APPS.forEach(a=>{
        const el = document.createElement('div');
        el.className = 'app';
        el.innerHTML = `<div style="font-size:20px; margin-bottom:6px">üîó</div><div style="font-weight:600">${a.name}</div>`;
        el.title = `Open ${a.name}`;
        el.addEventListener('click', ()=>openInViewer(a.url));
        appsGrid.appendChild(el);
      });
    }

    /***********************
     * Viewer behavior
     ***********************/
    function openInViewer(url){
      statusChip.textContent = 'Loading...';
      // if url looks like a search, convert
      let final = url;
      if(!/^https?:\/\//i.test(url) && !url.startsWith('about:')){
        // support t9os hash format for allowed iframes
        if(url.includes('#')) final = url;
        else final = 'https://t9os.com/active/iframe#https://'+encodeURI(url);
      }
      viewerFrame.src = final;
      viewerFrame.onload = ()=> statusChip.textContent = 'Ready';
      // track "tabs"
      trackTab(final);
    }

    function trackTab(url){
      openTabs.push(url);
      document.getElementById('openTabsCount').textContent = `Tabs: ${openTabs.length}`;
    }

    /***********************
     * Search / URL logic
     ***********************/
    function handleSearch(q){
      q = (q||'').trim();
      if(!q) return;
      // if it's explicitly a URL
      const looksLikeUrl = /^https?:\/\//i.test(q) || q.includes('.') && !q.includes(' ');
      if(looksLikeUrl){
        // if user sent a raw URL without protocol, try adding https
        const final = /^https?:\/\//i.test(q) ? q : 'https://' + q;
        openInViewer(final);
      } else {
        // search query -> use t9os wrapper to keep inside iframe (or fallback to google)
        const searchUrl = 'https://t9os.com/active/iframe#https://www.google.com/search?q=' + encodeURIComponent(q);
        openInViewer(searchUrl);
      }
    }

    /***********************
     * Small utilities
     ***********************/
    function openNewT9Tab(){
      // open new window with a viewer iframe opened to the same site (simple)
      const w = window.open('', '_blank');
      if(!w) {
        alert('Pop-up blocked. Allow pop-ups to open a new tab.');
        return;
      }
      const html = `
        <!doctype html><html><head><title>T9 Tab</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <style>body{margin:0;background:#000;color:#fff;}</style></head>
        <body><iframe src="${viewerFrame.src || 'about:blank'}" style="width:100vw;height:100vh;border:0"></iframe></body></html>`;
      w.document.write(html);
      w.document.close();
      // track
      openTabs.push('new-tab');
      document.getElementById('openTabsCount').textContent = `Tabs: ${openTabs.length}`;
    }

    /***********************
     * Time & battery
     ***********************/
    function updateTime(){
      const t = new Date();
      const hh = t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      document.getElementById('time').textContent = hh;
    }
    setInterval(updateTime, 1000);
    updateTime();

    // Battery (graceful if not supported)
    const batteryEl = document.getElementById('battery');
    if(navigator.getBattery) {
      navigator.getBattery().then(b => {
        function setB(){
          batteryEl.textContent = Math.round(b.level * 100) + '%';
        }
        setB();
        b.addEventListener('levelchange', setB);
      }).catch(()=>batteryEl.textContent='‚Äî%');
    } else batteryEl.textContent = '‚Äî%';

    /***********************
     * Event wiring
     ***********************/
    document.addEventListener('DOMContentLoaded', ()=> {
      renderWallpaperThumbs();
      renderApps();

      // restore wallpaper
      const saved = localStorage.getItem('t9_wall') || WALLPAPERS[0].id;
      setWallpaper(saved);

      // search events
      goBtn.addEventListener('click', ()=> handleSearch(searchInput.value));
      searchInput.addEventListener('keydown', e=>{
        if(e.key === 'Enter') handleSearch(searchInput.value);
      });

      // quick buttons
      openNewTabBtn.addEventListener('click', openNewT9Tab);
      openGamesBtn.addEventListener('click', ()=> openInViewer('/t9os.html'));
      openBrowserBtn.addEventListener('click', ()=> openInViewer('https://t9os.com/active/iframe#https://www.google.com'));

      // quick external links
      document.getElementById('open-discord').addEventListener('click', ()=> openInViewer('https://t9os.com/active/iframe#https://discord.gg/tknXENDkzY'));
      document.getElementById('open-youtube').addEventListener('click', ()=> openInViewer('https://t9os.com/active/iframe#https://www.youtube.com'));
      document.getElementById('open-patreon').addEventListener('click', ()=> openInViewer('https://www.patreon.com/c/T9OS'));

      // settings / small features
      document.getElementById('open-settings').addEventListener('click', ()=> {
        // simple prompt for wallpaper (fast)
        const choices = WALLPAPERS.map(w=>w.id).join(', ');
        const pick = prompt('Choose wallpaper id: ' + choices, localStorage.getItem('t9_wall') || WALLPAPERS[0].id);
        if(pick) setWallpaper(pick);
      });

      // toggle logo: simulate previous behavior by toggling .logo visibility
      document.getElementById('toggle-logo').addEventListener('click', ()=>{
        const l = document.querySelector('.logo');
        l.style.display = (getComputedStyle(l).display === 'none') ? 'flex' : 'none';
      });

      // "apps" taskbar button opens apps grid by focusing first app
      document.getElementById('task-apps').addEventListener('click', ()=> {
        const firstApp = appsGrid.querySelector('.app');
        if(firstApp) firstApp.scrollIntoView({behavior:'smooth', block:'center'});
      });

      // start with a default page so frame is not blank.
      openInViewer('https://t9os.com/active/iframe#https://t9os.com');
    });

    /***********************
     * Accessibility & performance notes
     ***********************/
    // - Minimal use of backdrop-filter and no heavy animated gradients to keep CPU low.
    // - If you want the old firebase "people online" counter, add your Firebase script and
    //   push a lightweight connection entry (we purposely left it out to keep this page fast).
  </script>
</body>
</html>
